#!/bin/bash
set -e -x

cd /var/vcap/packages/acceptance-tests

export GOROOT=/var/vcap/packages/golang
export GOPATH=$PWD/vendor
export PATH=$GOROOT/bin:$GOPATH/bin:$PWD/bin:$PATH
export CONFIG=$PWD/integration_config.json

cat > integration_config.json <<EOF
{
  "api_url":                         "<%= p("cf.api_url") %>",
  "apps_domain":                     "<%= p("cf.apps_domain") %>",
  "existing_service_instance_name":  "<%= p("cf.existing_service_instance_name") %>",
  "existing_service_instance_org":   "<%= p("cf.existing_service_instance_org") %>",
  "existing_service_instance_space": "<%= p("cf.existing_service_instance_space") %>",
  "admin_user":                      "<%= p("cf.admin_username") %>",
EOF

# don't expose passwords
set +x

cat >> integration_config.json <<EOF
  "admin_password":   "<%= p("cf.admin_password") %>",
}
EOF

set -x

bin/test errand
